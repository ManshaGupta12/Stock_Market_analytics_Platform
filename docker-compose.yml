version: '3.8'
services:
  api:
    image: python:3.11-slim
    container_name: stock-api
    working_dir: /app
    volumes:
      - ./:/app
    command: bash -c "pip install -r requirements.txt && python api/app_fastapi.py"
    ports:
      - '8000:8000'
    environment:
      - PYTHONUNBUFFERED=1

  gradio:
    image: python:3.11-slim
    container_name: stock-gradio
    working_dir: /app
    volumes:
      - ./:/app
    command: bash -c "pip install -r requirements.txt && python ui/gradio_app.py"
    ports:
      - '7860:7860'
    environment:
      - COHERE_API_KEY=${COHERE_API_KEY}

  grafana:
    image: grafana/grafana-oss:10.4.3
    container_name: stock-grafana
    ports:
      - '3000:3000'
    volumes:
      - grafana-storage:/var/lib/grafana
    environment:
      - GF_SECURITY_ADMIN_USER=admin
      - GF_SECURITY_ADMIN_PASSWORD=admin

volumes:
  grafana-storage:
